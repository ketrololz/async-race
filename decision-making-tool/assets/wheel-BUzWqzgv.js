var T=Object.defineProperty;var v=(o,a,t)=>a in o?T(o,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[a]=t;var h=(o,a,t)=>v(o,typeof a!="symbol"?a+"":a,t);import{A as E,a as N,B as g,C as c,M,W as y,o as I,b as A,c as S,d as C}from"./index-Lml8cxfM.js";import{B as p}from"./buttonComponent-CT2pQ0Fk.js";var f=(o=>(o[o.music=0]="music",o[o.sound=1]="sound",o))(f||{});class P{constructor(a=E){h(this,"music",new Audio);h(this,"sound",new Audio);this.paths=a,this.music.loop=!0}async playSound(a,t){const e=t===f.music?this.music:this.sound;return e.src=this.paths[a],e.currentTime=0,new Promise(n=>{e.onended=()=>n(),e.play()})}mute(){this.music.volume=0,this.sound.volume=0}unMute(){this.music.volume=N,this.sound.volume=N}}const x=new P;class B extends g{constructor(t,e){super({tag:"canvas",className:"wheel"});h(this,"width",0);h(this,"height",0);h(this,"ctx");h(this,"radius",0);h(this,"segments");h(this,"initAngle");h(this,"thisCurrentTitle");h(this,"resultAngle",0);h(this,"isEliminationMode",!1);this.onUpdate=e,this.initAngle=Math.random()*10,this.ctx=this.getNode().getContext("2d"),this.segments=this.calculateSegments(t),this.updateSize()}calculateSegments(t){let e=0;const n=t.reduce((i,s)=>(s.weight&&(i+=s.weight),i),0);return t.reduce((i,s)=>{const l={...s,startAngle:e,endAngle:e+s.weight/n*c};return i[s.id]=l,e=l.endAngle,i},{})}updateSize(){const t=Math.min(window.innerWidth,window.innerHeight)*y;this.width=this.getNode().width=t,this.height=this.getNode().height=t,this.radius=this.width/2.2,this.drawWheel(this.initAngle)}async rotate(t){const e=Math.random()*(3*t-1)+2;this.resultAngle=e*c%c,await this.rotateAnimation(t,e)}showCurrentTitle(t){this.thisCurrentTitle&&t.setText(this.thisCurrentTitle)}toggleEliminationMode(){return this.isEliminationMode=this.isEliminationMode===!1}rotateAnimation(t,e){return new Promise(n=>{let i;const s=l=>{i||(i=l);let d=(l-i)/t/1e3;d>1&&(d=1);const b=w(d);function w(u){return u<.5?4*u*u*u:1-Math.pow(-2*u+2,3)/2}const m=b*c*e+this.initAngle;this.ctx.clearRect(0,0,this.width,this.height),this.resultAngle=c-m%c,this.drawWheel(m);const r=this.getCurrentSegment(this.resultAngle);r&&r.title!==this.thisCurrentTitle&&(this.thisCurrentTitle=r.title,this.onUpdate(r.title)),d<1?requestAnimationFrame(s):(this.initAngle=m,this.isEliminationMode&&Object.keys(this.segments).length>2&&(r&&delete this.segments[r.id],this.segments=this.calculateSegments(Object.values(this.segments))),n())};requestAnimationFrame(s)})}drawWheel(t){const e=["#e25e52","#73cf52","#dbcb33","#35bad8","#9459c6"];let n=0;this.ctx.beginPath(),this.ctx.moveTo(this.width-this.width/22,this.height/2),this.ctx.arc(this.width/2,this.height/2,this.radius+this.radius/24,0,c),this.ctx.fillStyle="white",this.ctx.fill(),this.ctx.restore(),Object.values(this.segments).forEach(i=>{this.drawSegment(i.startAngle+t,i.endAngle+t,e[n],i.title),n>=4&&(n=1),n+=1}),this.ctx.beginPath(),this.ctx.moveTo(this.width-this.width/22,this.height/2),this.ctx.arc(this.width/2,this.height/2,this.radius,0,c),this.ctx.save(),this.ctx.clip(),this.ctx.lineWidth=this.width/15,this.ctx.strokeStyle="rgba(0, 0, 0, 0.2)",this.ctx.stroke(),this.ctx.restore(),this.ctx.save(),this.ctx.beginPath(),this.ctx.moveTo(this.width-this.width/22,this.height/2),this.ctx.arc(this.width/2,this.height/2,this.radius/20,0,c),this.ctx.fillStyle="white",this.ctx.shadowColor="rgba(0, 0, 0, 0.2)",this.ctx.shadowBlur=12,this.ctx.fill(),this.ctx.restore(),this.drawArrow()}drawSegment(t,e,n,i){this.ctx.beginPath(),this.ctx.moveTo(this.width/2,this.height/2),this.ctx.arc(this.width/2,this.height/2,this.radius,t,e),this.ctx.fillStyle=n,this.ctx.fill(),this.ctx.lineWidth=3,this.ctx.closePath(),this.ctx.strokeStyle="white",this.ctx.stroke();const s=i.trim();let l=s;s.length>M&&(l=s.slice(-10).concat("...")),this.ctx.save(),this.ctx.translate(this.width/2,this.height/2),this.ctx.rotate((t+e)/2),this.ctx.fillStyle="black",this.ctx.font=`${this.width/34}px Montserrat`,this.ctx.textAlign="left",this.ctx.textBaseline="middle",this.ctx.fillText(l,this.radius/4,0),this.ctx.restore()}drawArrow(){this.ctx.beginPath(),this.ctx.moveTo(this.width-this.width/8.7,this.width/2),this.ctx.lineTo(this.width-this.width/5+this.width/6.7,this.width/2+this.width/23),this.ctx.lineTo(this.width-this.width/5+this.width/6.7,this.width/2-this.width/23),this.ctx.closePath(),this.ctx.fillStyle="rgba(0, 0, 0, 0.03)",this.ctx.fill(),this.ctx.beginPath(),this.ctx.moveTo(this.width-this.width/10,this.width/2),this.ctx.lineTo(this.width-this.width/5+this.width/6,this.width/2+this.width/25),this.ctx.lineTo(this.width-this.width/5+this.width/6,this.width/2-this.width/25),this.ctx.closePath(),this.ctx.fillStyle="white",this.ctx.fill()}getCurrentSegment(t){return Object.values(this.segments).find(e=>e.startAngle<t&&t<e.endAngle)}}class D extends g{constructor(t){super({tag:"div",className:"container"});h(this,"router");h(this,"state",I);h(this,"rotationDuration",A);h(this,"isShowingAttention",!1);h(this,"title");h(this,"showCurrentTitle",t=>{this.title&&this.title.setText(t)});this.router=t,this.state.getOptions().length<1&&this.state.loadState();const e=new g({tag:"div",className:"buttons-container wheel-buttons-container"}),n=new g({tag:"div",className:"timer-container"}),i=new g({tag:"input",className:"timer"});i.setAttribute("type","number"),i.setAttribute("placeholder","sec"),i.getNode().value=String(A),i.addListener("input",u=>{u.target instanceof HTMLInputElement&&(this.rotationDuration=Number(u.target.value))});const s=new p({className:"options-button sound-btn",event:"click",listener:()=>{s.getNode().classList.contains("mute")?(s.toggleClass("mute"),this.state.changeSoundState(!1),x.unMute()):(s.toggleClass("mute"),x.mute(),this.state.changeSoundState(!0))}});this.state.isSoundMuteState()&&(s.getNode().classList.add("mute"),x.mute());const l=new p({className:"options-button back-btn",text:"back",event:"click",listener:()=>this.router.navigate("/options")}),d=new p({className:"elimination-btn",text:"elimination mode",event:"click",listener:()=>{r.toggleEliminationMode(),d.toggleClass("active")}}),b=new g({tag:"div",className:"settings-container"}),w=new p({className:"start-button",text:"spin the wheel",event:"click",listener:async()=>{if(this.rotationDuration<S){this.showAttention(`The rotation time should be from ${S} to ${C} seconds`);return}if(this.rotationDuration>500){this.showAttention(`The rotation time should be from ${S} to ${C} seconds`);return}this.disableButtons([w,i,l,s]),d.getNode().disabled=!0,x.playSound("baraban",f.sound).then(()=>{x.playSound("spin",f.sound)}),r.rotate(this.rotationDuration).then(()=>{x.playSound("end",f.sound),this.enableButtons([w,i,l,s]),d.getNode().disabled=!1})}});this.enableButtonIfCanPlay(w);const m=new g({tag:"h2",className:"segment-title",text:"SPIN IT!"});this.title=m;const r=new B(this.state.getSectorOptions(),this.showCurrentTitle);window.addEventListener("resize",()=>r.updateSize()),n.appendChildren([i.getNode()]),b.appendChildren([s.getNode(),n.getNode(),d.getNode()]),e.appendChildren([l.getNode(),b.getNode()]),this.appendChildren([e.getNode(),w.getNode(),m.getNode(),r.getNode()])}enableButtonIfCanPlay(t){const e=this.state.getSectorOptions().length<2;t.getNode().disabled=e}disableButtons(t){t.forEach(e=>e.getNode().disabled=!0)}enableButtons(t){t.forEach(e=>e.getNode().disabled=!1)}showAttention(t){if(!this.isShowingAttention){const e=new g({tag:"div",className:"attention-plate slide",text:t});this.appendChildren([e.getNode()]),this.isShowingAttention=!0,setTimeout(()=>{e.destroyNode(),this.isShowingAttention=!1},2500)}}}export{D as Wheel};
